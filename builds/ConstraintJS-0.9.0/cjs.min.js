/*ConstraintJS - v0.9.0*/

var cjs=function(a){"use strict";var b,c,d,e,f,g,h=Array.prototype,i=Object.prototype,j=(Function.prototype,h.slice),k=i.toString,l=h.concat,m=h.push,n=h.some,o=h.indexOf,p=h.every,q=h.forEach,r=Object.keys,s=h.filter,t=h.reduce,u=h.map,v=function(a,b){return function(){return a.apply(b,arguments)}},w=a.document,x=v(a.setTimeout,a),y=v(a.clearTimeout,a),z={"+":function(a){return+a},"-":function(a){return-a},"~":function(a){return~a},"!":function(a){return!a}},A={"===":function(a,b){return a===b},"!==":function(a,b){return a!==b},"==":function(a,b){return a==b},"!=":function(a,b){return a!=b},">":function(a,b){return a>b},">=":function(a,b){return a>=b},"<":function(a,b){return b>a},"<=":function(a,b){return b>=a},"+":function(a,b){return a+b},"-":function(a,b){return a-b},"*":function(a,b){return a*b},"/":function(a,b){return a/b},"%":function(a,b){return a%b},"^":function(a,b){return a^b},"&&":function(a,b){return a&&b},"||":function(a,b){return a||b},"&":function(a,b){return a&b},"|":function(a,b){return a|b},"<<":function(a,b){return a<<b},">>":function(a,b){return a>>b},">>>":function(a,b){return a>>>b}},B={},C=function(){var a=0;return function(){return a++}}(),D=function(a){return Q(a)?N(a)?a.slice():ab({},a):a},E=r||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b,c=[];for(b in a)a.hasOwnProperty(b)&&(c[c.length]=b);return c},F=function(a,b,c){return null==a?void 0:null==b||c?a[a.length-1]:j.call(a,Math.max(a.length-b,0))},G=function(a,b,c){var d=!1;return null==a?d:n&&a.some===n?a.some(b,c):(Z(a,function(a,e,f){return d||(d=b.call(c,a,e,f))?B:void 0}),!!d)},H=function(a,b,c){return j.call(a,null==b||c?1:b)},I=function(a,b,c){b=b||U;var d=!0;return a?p&&a.every===p?a.every(b,c):(Z(a,function(a,e,f){return(d=d&&b.call(c,a,e,f))?void 0:B}),!!d):d},J=function(a,b,c){return b&&I(a,N)?l.apply(c,a):(Z(a,function(a){N(a)||T(a)?b?m.apply(c,a):J(a,b,c):c.push(a)}),c)},K=function(a,b){return J(a,b,[])},L=a.console&&a.console.error?v(a.console.error,a.console):function(){},M=function(a){return"[object Number]"===k.call(a)},N=Array.isArray||function(a){return"[object Array]"===k.call(a)},O=function(a){return"[object Function]"===k.call(a)},P=function(a){return"[object String]"===k.call(a)},Q=function(a){return a===Object(a)},R=function(a){return!(!a||1!==a.nodeType)},S=function(a){return!!(a&&a.nodeType>0)},T=function(a){return"[object Arguments]"===k.call(a)},U=function(a){return a},V=function(a){return a?N(a)?j.call(a):T(a)?j.call(a):a.toArray&&O(a.toArray)?a.toArray():$(a,U):[]},W=function(a,b){var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a,a.superclass=b.prototype,b.prototype.constructor===i.constructor&&(b.prototype.constructor=b)},X=i.hasOwnProperty,Y=function(a,b){return X.call(a,b)},Z=function(a,b,c){var d,e,f;if(a)if(q&&a.forEach===q)a.forEach(b,c);else if(a.length===+a.length){for(d=0,f=a.length;f>d;d++)if(Y(a,d)&&b.call(c,a[d],d,a)===B)return}else for(e in a)if(Y(a,e)&&b.call(c,a[e],e,a)===B)return},$=function(a,b,c){var d=[];return a?u&&a.map===u?a.map(b,c):(Z(a,function(a,e,f){d[d.length]=b.call(c,a,e,f)}),a.length===+a.length&&(d.length=a.length),d):d},_=function(a,b,c){var d=[];return a?s&&a.filter===s?a.filter(b,c):(Z(a,function(a,e,f){b.call(c,a,e,f)&&d.push(a)}),d):d},ab=function(a){var b,c=arguments.length,d=function(b,c){a[c]=b};for(b=1;c>b;b++)Z(arguments[b],d);return a},bb=function(a,b,c){var d,e=a.length;for(d=c||0;e>d;d++)if(b(a[d],d))return d;return-1},cb=function(a,b){return a===b},db=function(a,b,c,d){return d||c||!o||a.indexOf!==o?(d=d||cb,bb(a,function(a){return d(b,a)},c)):a.indexOf(b)},eb=function(a,b){return fb(a,db(a,b))},fb=function(a,b){return b>=0?a.splice(b,1)[0]:b},gb=function(a,b,c){var d=arguments.length>2;return a||(a=[]),t&&a.reduce===t?d?a.reduce(b,c):a.reduce(b):(Z(a,function(a,d,e){c=b(c,a,d,e)}),c)},hb=function(a,b,c,d,e,f,g){var h=b[a],i=d[h]+1;return i=db(c,h,i>e?i:e,g),0>i&&(i=f),d[h]=i,i},ib=function(a,b,c){var d,e,f,g={},h=0,i=0,j=0,k=a.length,l=b.length,m=new Array(l>k?l:k);if(0===l||0===k)return[];for(d=hb(0,a,b,g,h,l,c),f=0;k>f;f++)i=h===i?d:hb(f,a,b,g,h,l,c),d=hb(f+1,a,b,g,h,l,c),i>d?(f++,e=d):e=i,e===l||f===k?i=hb(f,a,b,g,h,l,c):(h=e,m[j]={item:a[f],indicies:[f,e]},j++);return m.slice(0,j)},jb=function(a,b,c){var d,e,f,g=D(b),h=a.length,i=b.length,j=[],k=0;if(0===i||0===h)return a;for(d=0;h>d;d+=1)if(f=a[d],e=db(g,f,0,c),e>=0){if(fb(g,e),0===--i){j.push.apply(j,H(a,d+1));break}}else j[k]=f,k++;return j},kb=function(a,b,c){var d,e,f,g=D(b),h=a.length,i=b.length,j=[];for(d=0;h>d&&i>0;d++)f=a[d],e=db(g,f,0,c),e>=0&&(j.push([f,fb(g,e)]),i--);return j},lb=function(a){var b=a[1].item;return{item:b,from:a[0].index,to:a[1].index,from_item:a[0].item,to_item:b}},mb=function(a,b){return{item:a,index:b}},nb=function(a){return{item:a.item,from:a.indicies[0],to:a.indicies[1]}},ob=function(a){return a.index},pb=function(a){return a.to},qb=function(a){return{from:a.index,from_item:a.item}},rb=function(a,b,c){var d=c||cb,e=function(a,b){return d(a?a.item:a,b?b.item:b)},f=$(a,mb),g=$(b,mb),h=$(ib(a,b),nb),i=jb(f,h,e),j=jb(g,h,e),k=$(kb(i,j,e),lb);j=jb(j,k,e),i=jb(i,k,e);var l=$(j,ob),m=$(k,pb),n=$(h,pb),o=$(b,function(b,c){var d,e;return(e=db(l,c))>=0?(d=j[e],{to:c,to_item:b,item:b}):(e=db(m,c))>=0?(d=k[e],{to:c,to_item:b,item:b,from:d.from,from_item:d.from_item}):(e=db(n,c))>=0?(d=h[e],{to:c,to_item:b,item:b,from:d.from,from_item:a[d.from]}):void 0});return o.concat($(i,qb))},sb=function(a){return a.hasOwnProperty("from")},tb=function(a){return!sb(a)},ub=function(a){return a.hasOwnProperty("to")},vb=function(a){return!ub(a)},wb=function(a){return sb(a)&&ub(a)},xb=function(a){return wb(a)&&a.from!==a.to},yb=function(a,b){var c=sb(a),d=sb(b);return c&&d?a.from-b.from:c&&!d?-1:!c&&d?1:0},zb=function(a,b,c){var d=rb(a,b,c),e=D(d).sort(yb),f=_(d,tb),g=_(e,vb).reverse(),h=_(d,xb),i=[];return Z(g,function(a){fb(e,a.from)}),Z(f,function(a){e.splice(a.to,0,a)}),Z(d,function(a,b){if(wb(a)&&e[b]!==a){var c=db(e,a,b);e.splice(b,0,fb(e,c)),i.push({move_from:c,insert_at:b,item:a.item,from:a.from,to:a.to})}}),e=null,{added:f,removed:g,moved:i,index_changed:h,mapping:d}},Ab=/-([a-z]|[0-9])/gi,Bb=/^-ms-/,Cb=function(a,b){return String(b).toUpperCase()},Db=function(a){return a.replace(Bb,"ms-").replace(Ab,Cb)},Eb=function(a,e){return N(a)?new c(ab({value:a},e)):nd(a)?Eb.inputValue(a):Q(a)&&!O(a)?new d(ab({value:a},e)):new b(a,e)};if(Eb.version="0.9.0",Eb.__debug=!1,Eb.arrayDiff=zb,Eb.toString=function(){return"ConstraintJS v"+Eb.version},Y(a,"cjs")){var Fb=a.cjs;Eb.noConflict=function(){return a.cjs=Fb,Eb}}else Eb.noConflict=function(){return delete a.cjs,Eb};var Gb={stack:[],getValue:function(a){var b,c,d=this,e=Gb.stack,f=e.length;return f>0&&(b=e[f-1],c=d._outEdges[b._id],c?c.tstamp=b._tstamp+1:d._options.auto_add_outgoing_dependencies!==!1&&b._options.auto_add_incoming_dependencies!==!1&&a!==!1&&(d._outEdges[b._id]=b._inEdges[d._id]={from:d,to:b,tstamp:b._tstamp+1})),d._valid||(e[f]=d,d._valid=!0,d._tstamp+=1,d._options.cache_value!==!1?d._cached_value=O(d._value)&&!d._options.literal?d._value.call(d._options.context):d._value:O(d._value)&&d._value.call(d._options.context),e.length=f),d._cached_value},add_in_call_stack:function(a){a.in_call_stack=!0},nullify:function(a){var b,c,d,e,f,g,h,i,j,k=[a],l=1,m=this._is_nullifying!==!0;for(m&&(this._is_nullifying=!0),b=0;l>b;b+=1)if(f=k[b],k[b]=!1,f._valid&&(f._valid=!1,e=!0,f._options.cache_value!==!1&&f._options.check_on_nullify===!0&&(g=f._options.equals||cb,h=f._cached_value,i=f.get(),g(h,i)&&(e=!1)),e)){j=f._changeListeners,Z(j,this.add_in_call_stack),this.nullified_call_stack.push.apply(this.nullified_call_stack,j),c=f._outEdges;for(d in c)if(Y(c,d)){var n=c[d],o=n.to;n.tstamp<o._tstamp?(delete f._outEdges[d],delete o._inEdges[a._id]):(k[l]=o,l+=1)}}m&&(this.semaphore>=0&&this.nullified_call_stack.length>0&&this.run_nullified_listeners(),delete this._is_nullifying)},removeDependency:function(a,b){delete a._outEdges[b._id],delete b._inEdges[a._id]},semaphore:0,wait:function(){this.semaphore-=1},signal:function(){this.semaphore+=1,this.semaphore>=0&&this.nullified_call_stack.length>0&&this.run_nullified_listeners()},nullified_call_stack:[],running_listeners:!1,clearEdges:function(a,b){b!==!0&&this.wait();var c=a._id;Z(a._inEdges,function(b,d){var e=b.from;delete e._outEdges[c],delete a._inEdges[d]}),Z(a._outEdges,function(d,e){var f=d.to;b!==!0&&Gb.nullify(f),delete f._inEdges[c],delete a._outEdges[e]}),b!==!0&&this.signal()},run_nullified_listeners:function(){var a,b,c;if(!this.running_listeners){for(this.running_listeners=!0;this.nullified_call_stack.length>0;)if(a=this.nullified_call_stack.shift(),b=a.callback,c=a.context||this,a.in_call_stack=!1,Eb.__debug)b.apply(c,a.args);else try{b.apply(c,a.args)}catch(d){L(d)}this.running_listeners=!1}},remove_from_call_stack:function(a){eb(this.nullified_call_stack,a)}};b=function(b,c){this._options=ab({context:a},c),this._value=b,this._id=C(),this._outEdges={},this._inEdges={},this._changeListeners=[],this._tstamp=0,this._options.literal||!O(this._value)?(this._valid=!0,this._cached_value=this._value):(this._valid=!1,this._cached_value=void 0)},function(a){var c=a.prototype;c.get=Gb.getValue,c.set=function(a){var b=this._value;if(this._value=a,this._options.literal||!O(a)){var c=this._options.equal||cb;c(b,a)||Gb.nullify(this)}else b!==a&&Gb.nullify(this);return this},c.setOption=function(a,b){return P(a)?this._options[a]=b:ab(this._options,a),Gb.nullify(this),this},c.invalidate=function(){return Gb.nullify(this),this},c.remove=function(a){return Gb.clearEdges(this,a),this._valid=!1,this._cached_value=void 0,this},c.destroy=function(a){return Z(this._changeListeners,function(a){a.in_call_stack&&Gb.remove_from_call_stack(a)}),this.remove(a),this._options={},this._changeListeners=[],this},c.onChange=function(a,b){j.call(arguments,2);return this._changeListeners.push({callback:a,context:b,args:j.call(arguments,2),in_call_stack:!1}),this._options.run_on_add_listener!==!1&&this.get(!1),this},c.offChange=function(a,b){var c,d;for(d=this._changeListeners.length-1;d>=0;d-=1)if(c=this._changeListeners[d],c.callback===a&&(!b||c.context===b)){this._changeListeners.splice(d,1),c.in_call_stack&&Gb.remove_from_call_stack(c);break}return this},c.and=function(){var a=[this].concat(V(arguments)),c=a.length;return new b(function(){for(var b,d=0;c>d;d++)if(!(b=Eb.get(a[d])))return!1;return b})},c.or=function(){var a=[this].concat(V(arguments)),c=a.length;return new b(function(){for(var b,d=0;c>d;d++)if(b=Eb.get(a[d]))return b;return!1})};var d=function(a){return function(){var c=arguments,d=new b(function(){return a.apply(d,$(c,Eb.get))});return c=[this].concat(V(c)),d}};c.add=d(function(){return gb(arguments,A["+"],0)}),c.sub=d(function(){return gb(arguments,A["-"],0)}),c.mul=d(function(){return gb(arguments,A["*"],1)}),c.div=d(function(){return gb(arguments,A["/"],1)}),Z(["abs","pow","round","floor","ceil","sqrt","log","exp"],function(a){c[a]=d(v(Math[a],Math))}),Z({u:{pos:"+",neg:"-",not:"!",bitwiseNot:"~"},bi:{eqStrct:"===",neqStrict:"!==",eq:"==",neq:"!=",gt:">",ge:">=",lt:"<",le:"<=",mod:"%",xor:"^",bitwiseAnd:"&",bitwiseOr:"|",rightShift:">>",leftShift:"<<",unsignedRightShift:">>>"}},function(a,b){var e="u"===b?z:A;Z(a,function(a,b){c[b]=d(e[a])})})}(b),e=function(a){return a instanceof b},Eb.isConstraint=e,Eb.Constraint=b,Eb.constraint=function(a,c){return new b(a,c)},Eb.get=function(a,b){return e(a)?a.get(b):f(a)?a.toArray():g(a)?a.toObject():a},Eb.wait=v(Gb.wait,Gb),Eb.signal=v(Gb.signal,Gb),Eb.removeDependency=Gb.removeDependency;var Hb=function(a){return M(a)&&Math.round(a)===a&&a>=0};c=function(a){a=ab({equals:cb,value:[]},a),this._value=$(a.value,function(a){return new b(a,{literal:!0})}),this._unsubstantiated_items=[],this.$len=new b(this._value.length),this.$equality_check=new b(a.equals,{literal:!0})},function(c){var d=c.prototype;c.BREAK={};var g=function(a,c){var d=a._value[c];return void 0===d&&(d=new b(void 0,{literal:!0}),a._unsubstantiated_items[c]=d),d.get()},h=function(a,c,d){Eb.wait();var f=a._value[c];if(void 0===f&&a._unsubstantiated_items[c]&&(f=a._value[c]=a._unsubstantiated_items[c],delete a._unsubstantiated_items[c]),e(f)){{f.get()}f.set(d)}else a._value[c]=new b(d,{literal:!0});k(a),Eb.signal()},i=function(a,b){var c;for(Eb.wait();a._value.length>0;){c=a._value.pop();{a._value.length}e(c)&&c.destroy(b)}return k(a),Eb.signal(),this},k=function(a){a.$len.set(a._value.length)};d.setEqualityCheck=function(a){return this.$equality_check.set(a),this},d.forEach=function(b,d){var e,f=this.length();for(d=d||a,e=0;f>e;e+=1)if(b.call(d,g(this,e),e)===c.BREAK)return this;return this},d.map=function(b,c){var d=[];return c=c||a,this.forEach(function(a,e){d[e]=b.call(c,a,e)}),d},d.setValue=function(a){return Eb.wait(),i(this),this.push.apply(this,a),Eb.signal(),this},d.item=function(a,b){return 0===arguments.length?this.toArray():1===arguments.length?g(this,a):arguments.length>1?h(this,a,b):void 0},d.destroy=function(a){i(this,a),this.$len.destroy(a)},d.length=function(){return this.$len.get()},d.push=function(){var a,b=arguments.length,c=this._value.length;for(Eb.wait(),a=0;b>a;a+=1)h(this,c+a,arguments[a]);return Eb.signal(),this.length()},d.pop=function(){var a,b=this._value.pop();return Eb.wait(),e(b)&&(a=b.get(),b.destroy()),k(this),Eb.signal(),a},d.toArray=function(){return this.map(U)},d.indexWhere=function(a,b){var c,d,e=this.length();for(b=b||this,c=0;e>c;c+=1)if(d=this._value[c],a.call(b,d.get(),c))return c;return-1},d.lastIndexWhere=function(a,b){var c,d,e=this.length();for(b=b||this,c=e-1;c>=0;c-=1)if(d=this._value[c],a.call(b,d.get(),c))return c;return-1},d.indexOf=function(a,b){b=b||this.$equality_check.get();var c=function(c){return b(c,a)};return this.indexWhere(c)},d.lastIndexOf=function(a,b){b=b||this.$equality_check.get();var c=function(c){return b(c,a)};return this.lastIndexWhere(c)},d.some=function(a,b){return this.indexWhere(a,b)>=0},d.every=function(a,b){var d=!0;return this.forEach(function(){return a.apply(b,arguments)?void 0:(d=!1,c.BREAK)}),d},d.splice=function(a,b){var c;if(M(b)||(b=0),!Hb(a)||!Hb(b))throw new Error("index and howmany must be positive integers");var d=j.call(arguments,2),f=d.length;Eb.wait();var i=f-b,l=$(this._value.slice(a,a+b),function(a){return a?a.get():void 0});if(0>i){var m=this._value.length,n=a+f,o=m+i;for(c=a;n>c;c+=1)h(this,c,d[c-a]);for(;o>c;c+=1)h(this,c,g(this,c-i));for(;m>c;c+=1){var p=this._value.pop();e(p)&&p.destroy()}}else for(c=this._value.length+i-1;c>=a;c-=1)a+f>c?h(this,c,d[c-a]):h(this,c,g(this,c-i));return 0!==i&&k(this),Eb.signal(),l},d.shift=function(){var a=this.splice(0,1);return a[0]},d.unshift=function(){return this.splice.apply(this,[0,0].concat(V(arguments))),this.length()},d.concat=function(){var a=$(arguments,function(a){return f(a)?a.toArray():a}),b=this.toArray();return b.concat.apply(b,a)},d.slice=function(){var a=this._value.slice.apply(this._value,arguments);return $(a,function(a){return a?a.get():void 0})},d.getConstraint=function(a){return new b(function(){return this.item(Eb.get(a))},{context:this})},Z(["filter","join","sort","reverse","valueOf","toString"],function(a){d[a]=function(){var b=this.toArray();return b[a].apply(b,arguments)}})}(c),f=function(a){return a instanceof c},Eb.array=function(a){return new c(a)},Eb.isArrayConstraint=f,Eb.ArrayConstraint=c;var Ib=function(a){return a.toString()},Jb=function(a){return function(b){return b[a]()}};d=function(a){a=ab({hash:Ib,valuehash:!1,equals:cb,valueequals:cb,value:{},keys:[],values:[],literal_values:!0,create_unsubstantiated:!0},a),Z(a.value,function(b,c){a.keys.push(c),a.values.push(b)},this),this._default_literal_values=!!a.literal_values,this.$equality_check=new b(a.equals,{literal:!0}),this.$vequality_check=new b(a.valueequals,{literal:!0}),this._hash=P(a.hash)?Jb(a.hash):a.hash,this._create_unsubstantiated=a.create_unsubstantiated,this._khash={},a.valuehash?(this._vhash={},this._valuehash=O(a.valuehash)?a.valuehash:P(a.valuehash)?Jb(a.valuehash):Ib):this._vhash=!1;var c=this._default_literal_values;this._ordered_values=$(a.keys,function(d,e){var f=a.values[e],g={key:new b(d,{literal:!0}),value:new b(f,{literal:c}),index:new b(e,{literal:!0})},h=this._hash(d),i=this._khash[h];if(i?i.push(g):this._khash[h]=[g],this._vhash){var j=this._valuehash(f),k=this._vhash[j];k?k.push(g):this._vhash[j]=[g]}return g},this),this._unsubstantiated_values={},this.$keys=new b(this._do_get_keys,{context:this}),this.$values=new b(this._do_get_values,{context:this}),this.$entries=new b(this._do_get_entries,{context:this}),this.$size=new b(this._do_get_size,{context:this})},function(a){a.BREAK=c.BREAK;var d=a.prototype,e=function(a,c,d){var e=this._hash(a),f={h:e,hv:!1,i:-1,ui:-1,uhv:!1},g=this.$equality_check.get(),h=function(b){return g(b.key.get(),a)},i=this._khash[e];if(i){var j=bb(i,h);if(f.hv=i,j>=0)return f.i=j,f}if(c!==!1){var k=this._unsubstantiated_values[e],l=-1;if(k&&(f.uhv=k,l=bb(k,h),l>=0))return f.ui=l,f;if(d===!0){var m=this._default_literal_values,n={key:new b(a,{literal:!0}),value:new b(void 0,{literal:m}),index:new b(-1,{literal:!0})};k?(l=k.length,k[l]=n):(l=0,this._unsubstantiated_values[e]=k=[n])}f.uhv=k||!1,f.ui=l}return f},f=function(a,c,d,e,f){var h,i,j,k,l=a.i,m=a.hv,n=a.h;if(l>=0){if(k=m[l],this._vhash){var o=k.value.get(),p=this._valuehash(o),q=this._vhash[p];if(i=this._valuehash(d),q){var r=q.length;for(h=0;r>h;h+=1)if(q[h]===k){q.splice(h,1),0===q.length&&delete this._vhash[p];break}}j=this._vhash[i],j?j.push(k):this._vhash[i]=[k]}if(k.value.set(d),Hb(e)){var s=k.index.get();if(s!==e){this._ordered_values.splice(s,1),this._ordered_values.splice(e,0,k);var t=Math.min(s,e),u=Math.max(s,e);for(h=t;u>=h;h+=1)g(this._ordered_values[h],h);this.$keys.invalidate()}}}else{Hb(e)||(e=this._ordered_values.length);var v=a.ui;if(v>=0){var w=a.uhv,x=w[v];w.splice(v,1),0===w.length&&delete this._unsubstantiated_values[n],k=x,k.value.set(d),k.index.set(e)}else k={key:new b(c,{literal:!0}),value:new b(d,{literal:void 0===f?this._default_literal_values:!!f}),index:new b(e,{literal:!0})};for(m?m.push(k):m=this._khash[n]=[k],this._vhash&&(i=this._valuehash(d),j=this._vhash[i],j?j.push(k):this._vhash[i]=[k]),this._ordered_values.splice(e,0,k),h=e+1;h<this._ordered_values.length;h+=1)g(this._ordered_values[h],h);this.$size.invalidate(),this.$keys.invalidate()}this.$values.invalidate(),this.$entries.invalidate()},g=function(a,b){a.index.set(b)},h=function(a,b){Z(a,function(a){a.key.destroy(b),a.value.destroy(b),a.index.destroy(b)})},i=function(a,b){this._ordered_values[a];h(this._ordered_values.splice(a,1),b),b!==!0&&this.$size.invalidate()};d._do_get_keys=function(){var a=[];return this.forEach(function(b,c,d){a[d]=c}),a},d.keys=function(){return this.$keys.get()},d._do_get_values=function(){var a=[];return this.forEach(function(b,c,d){a[d]=b}),a},d.values=function(){return this.$values.get()},d._do_get_entries=function(){var a=[];return this.forEach(function(b,c,d){a[d]={key:c,value:b}}),a},d.entries=function(){return this.$entries.get()},d._do_get_size=function(){return this._ordered_values.length},d.size=function(){return this.$size.get()},d.isEmpty=function(){return 0===this.size()},d.set=d.put=function(a,b,c,d){Eb.wait();var g=e.call(this,a,!0,!1);return f.call(this,g,a,b,c,d),Eb.signal(),this},d.remove=function(a){var b,c=e.call(this,a,!1,!1),d=c.i,f=c.hv;if(d>=0){Eb.wait();var h=f[d],j=h.index.get();if(f.splice(d,1),0===f.length&&delete this._khash[c.h],this._vhash){var k=this._valuehash(h.value.get()),l=this._vhash[k];if(l){var m=l.length;for(b=0;m>b;b+=1)if(l[b]===h){l.splice(b,1),0===l.length&&delete this._vhash[k];break}}}for(i.call(this,j),b=j;b<this._ordered_values.length;b+=1)g(this._ordered_values[b],b);this.$size.invalidate(),this.$keys.invalidate(),this.$values.invalidate(),this.$entries.invalidate(),Eb.signal()}return this},d.get=function(a){var b=e.call(this,a,!0,this._create_unsubstantiated),c=b.i,d=b.hv;if(c>=0){var f=d[c];return f.value.get()}if(this._create_unsubstantiated){var g=b.uhv[b.ui];return g.value.get()}return void 0},d.getConstraint=function(a){return new b(function(){return this.get(Eb.get(a))},{context:this})},d.clear=function(a){if(this.size()>0){for(Eb.wait();this._ordered_values.length>0;)i.call(this,0,a);Z(this._khash,function(a,b){delete this._khash[b]},this),this._vhash&&Z(this._vhash,function(a,b){delete this._vhash[b]},this),a||(this.$keys.invalidate(),this.$values.invalidate(),this.$entries.invalidate(),this.$size.invalidate()),Eb.signal()}return this},d.forEach=function(b,c){var d,e,f=this.size(),g=this._ordered_values.slice();for(c=c||this,d=0;f>d&&(e=g[d],!e||b.call(c,e.value.get(),e.key.get(),e.index.get())!==a.BREAK);d+=1);return this},d.setEqualityCheck=function(a){return this.$equality_check.set(a),this},d.setValueEqualityCheck=function(a){return this.$vequality_check.set(a),this},d.setHash=function(a){Eb.wait(),this._hash=P(a)?Jb(a):a,this._khash={},Z(this._ordered_values,function(a){var b=a.key.get(),c=this._hash(b),d=this._khash[c];d?d.push(a):this._khash[c]=[a]},this);var b={};return Z(this._unsubstantiated_values,function(a){Z(a,function(a){var c=a.key.get(),d=this._hash(c),e=this.new_unsubstatiated_values[d];e?e.push(a):b[d]=[a]},this)},this),this._unsubstantiated_values=b,Eb.signal(),this},d.setValueHash=function(a){return this._valuehash=P(a)?Jb(a):a,this._vhash={},this._valuehash&&Z(this._ordered_values,function(a){var b=a.value.get(),c=this._valuehash(b),d=this._vhash[c];d?d.push(a):this._vhash[c]=[a]},this),this},d.item=function(a,b,c){return 0===arguments.length?this.toObject():1===arguments.length?this.get(a):this.put(a,b,c)},d.indexOf=function(a){var b=e.call(this,a,!0,this._create_unsubstantiated),c=b.i,d=b.hv;if(c>=0){var f=d[c];return f.index.get()}if(b.ui>=0){var g=b.uhv[b.ui];return g.index.get()}return-1},d.get_or_put=function(a,b,c,d,g){{var h=e.call(this,a,!0,!1),i=h.i,j=h.hv;h.h}if(i>=0){var k=j[i];return k.value.get()}Eb.wait();var l=c||this,m=b.call(l,a);return f.call(this,h,a,m,d,g),Eb.signal(),m},d.has=d.containsKey=function(a){var b=e.call(this,a,!0,this._create_unsubstantiated),c=b.i;if(c>=0)return!0;if(this._create_unsubstantiated){var d=b.uhv[b.ui];return d.index.get(),!1}return!1},d.moveIndex=function(a,b){var c;Eb.wait();var d=this._ordered_values[a];this._ordered_values.splice(a,1),this._ordered_values.splice(b,0,d);var e=Math.min(a,b),f=Math.max(a,b);for(c=e;f>=c;c+=1)g(this._ordered_values[c],c);return this.$keys.invalidate(),this.$values.invalidate(),this.$entries.invalidate(),Eb.signal(),this},d.move=function(a,b){var c=e.call(this,a,!1,!1),d=c.i;if(d>=0){var f=c.hv[d];this.moveIndex(f.index.get(),b)}return this},d.keyForValue=function(b,c){c=c||this.$vequality_check.get();var d;if(this._vhash){var e=this._valuehash(b),f=this._vhash[e];if(f){var g=f.length;for(d=0;g>d;d+=1){var h=f[d];if(c(h.value.get(),b))return h.key.get()}}return void 0}var i;return this.forEach(function(d,e){return c(b,d)?(i=e,a.BREAK):void 0}),i},d.destroy=function(a){Eb.wait(),this.clear(a),this.$equality_check.destroy(a),this.$vequality_check.destroy(a),this.$keys.destroy(a),this.$values.destroy(a),this.$entries.destroy(a),this.$size.destroy(a),Eb.signal()},d.toObject=function(a){var b={};return a=a||U,this.forEach(function(c,d){b[a(d)]=c}),b}}(d),g=function(a){return a instanceof d},Eb.map=function(a,b){return new d(a,b)},Eb.isMapConstraint=g,Eb.MapConstraint=d,Eb.liven=function(c,d){d=ab({context:a,run_on_create:!0,pause_while_running:!1,on_destroy:!1},d);var e,f=new b(c,{context:d.context,cache_value:!1,auto_add_outgoing_dependencies:!1,run_on_add_listener:!!d.run_on_create}),g=!1,h=function(a){d.on_destroy&&d.on_destroy.call(d.context,a),f.destroy(a),f=null},i=function(){return g===!1?(g=!0,f.offChange(e),!0):!1},j=function(){return g===!0?(g=!1,f.onChange(e),!0):!1};e=function(){d.pause_while_running&&i(),f.get(),d.pause_while_running&&j()},f.onChange(e);var k={destroy:h,pause:i,resume:j,run:function(a){return e(a),this},_constraint:f};return k};var Kb=function(){var a,b=arguments.length,c="";for(a=0;b>a;a+=1)c+=arguments[a];return c},Lb=function(a,b){var c,d=a.length;if(d===b.length){for(c=0;d>c;c+=1){var e=a[c],f=b[c];if(e!==f)return!1}return!0}return!1},Mb=function(c,e){e=ab({hash:Kb,equals:Lb,context:a,literal_values:!1},e);var f=new d({hash:e.hash,equals:e.equals,literal_values:e.literal_values}),g=function(){var a=V(arguments),d=f.get_or_put(a,function(){return new b(function(){return c.apply(e.context,a)})});return d.get()};return g.destroy=function(a){f.forEach(function(b){b.destroy(a)}),f.destroy(a),f=null,e=null},g.each=function(a){f.forEach(a)},g};Eb.memoize=Mb;var Nb=function(a){if(S(a))return a;var b=w.createTextNode(a);return b},Ob=function(a,b,c){var d=b.childNodes;if(d.length<=c)b.appendChild(a);else{var e=d[c];b.insertBefore(a,e)}},Pb=function(a){var b=a.parentNode;null!==b&&b.removeChild(a)},Qb=function(a,b){var c,d=a.childNodes;d.length>b&&(c=d[b],Pb(c))},Rb=function(a,b,c){var d=a.childNodes;if(d.length>c){var e=d[c];a&&(b>c&&b++,Ob(e,a,b))}},Sb=function(b){return Y(a,"jQuery")?b instanceof a.jQuery:!1},Tb=a.NodeList||!1,Ub=Tb?function(a){return a instanceof Tb}:function(){return!1},Vb=function(b){return N(b)?b:e(b)?Vb(b.get()):f(b)?b.toArray():g(b)?b.values():Sb(b)?a.jQuery.makeArray(b):Ub(b)?V(b):[b]},Wb=function(a){var b=a.targets,c=(a.initialValue,a.onAdd),d=a.onRemove,e=a.onMove,f=a.setter,g=a.getter,h=a.init_val;this._throttle_delay=!1,this._timeout_id=!1;var i,j;j=O(h)?h(Vb(b[0])):h;var k=[];this._do_update=function(){this._timeout_id=!1;var a=_(Vb(b),S);if(c||d||e){var g=zb(k,a);Z(d&&g.removed,function(a){d(a.from_item,a.from)}),Z(c&&g.added,function(a){c(a.item,a.to)}),Z(e&&g.moved,function(a){e(a.item,a.to_index,a.from_index)}),k=a}Z(a,function(a){f(a,i,j)}),j=i},this.$live_fn=Eb.liven(function(){i=g(),this._throttle_delay&&!this._timeout_id?this._timeout_id=x(v(this._do_update,this),this._throttle_delay):this._do_update()},{context:this})};!function(a){var b=a.prototype;b.pause=function(){this.$live_fn.pause()},b.resume=function(){this.$live_fn.resume()},b.throttle=function(a){return this._throttle_delay=a>0?a:!1,this._throttle_delay&&this._timeout_id&&(y(this._timeout_id),this._timeout_id=!1),this.$live_fn.run(),this},b.destroy=function(){this.$live_fn.destroy()}}(Wb);var Xb=function(a,b,c){return function(d){var e=j.call(arguments,1),f=Eb(function(){return a(e)}),g=new Wb({targets:d,getter:function(){return f.get()},setter:function(a,c,d){b(a,c,d)},init_val:c});return g}},Yb=function(a){return Xb(function(a){return $(a,Eb.get).join("")},function(b,c){a(b,c)})},Zb=Yb(function(a,b){a.textContent=b}),$b=Yb(function(a,b){a.innerHTML=b}),_b=Yb(function(a,b){a.val=b}),ac=Xb(function(a){var b=$(a,function(a){return Eb.get(a)});return K(b,!0)},function(a,b,c){var d=zb(c,b),e=" "+a.className+" ",f=$(d.added,function(a){return a.item}).join(" ");Z(d.removed,function(a){e=e.replace(" "+a.from_item+" "," ")}),e+=f,e=e.trim(),a.className=e},[]),bc=Xb(function(a){var b=$(a,function(a){return Eb.get(a)});return $(K(b,!0),Nb)},function(a,b,c){var d=zb(c,b);Z(d.removed,function(b){Qb(a,b.from)}),Z(d.added,function(b){Ob(b.item,a,b.to)}),Z(d.moved,function(b){Rb(a,b.to_index,b.from_index)})},function(a){return V(a.childNodes)}),cc=function(a){return function(b){var c,d=j.call(arguments,1);if(0!==d.length){1===d.length?c=d[0]:d.length>1&&(c={},c[d[0]]=d[1]);var e=new Wb({targets:b,setter:function(b,c){Z(c,function(c,d){a(b,d,c)})},getter:function(){var a,b={};return a=g(c)?c.toObject():c,Z(a,function(a,c){b[c]=Eb.get(a)}),b}});return e}}},dc=cc(function(a,b,c){a.style[Db(b)]=c}),ec=cc(function(a,b,c){a.setAttribute(b,c)});ab(Eb,{text:Zb,html:$b,val:_b,"class":ac,children:bc,attr:ec,css:dc});var fc=["keyup","input","paste","propertychange","change"];Eb.inputValue=function(a){var b;R(a)?(a=[a],b=!1):b=!0;var c=Eb(function(){return b?$(a,function(a){return a.value}):a[0].value}),d=(a.length,v(c.invalidate,c)),e=function(){Z(fc,function(b){Z(a,function(a){a.addEventListener(b,d)})})},f=function(){Z(fc,function(b){Z(a,function(a){a.removeEventListener(b,d)})})},g=c.destroy;return c.destroy=function(){f(),g.call(c)},e(),c};var gc=function(a,b){this._fsm=a,this._name=b,this._id=C()};!function(a){var b=a.prototype;b.getName=function(){return this._name},b.id=function(){return this._id}}(gc);var hc=function(a,b,c,d){this._fsm=a,this._from=b,this._to=c,this._name=d,this._id=C()};!function(a){var b=a.prototype;b.getFrom=function(){return this._from},b.getTo=function(){return this._to},b.getName=function(){return this._name},b.getFSM=function(){return this._fsm},b.id=function(){return this._id},b.run=function(){var a=this.getFSM();if(a.is(this.getFrom())){var b=V(arguments);b.unshift(this),b.unshift(this.getTo()),a._setState.apply(a,b)}}}(hc);var ic=function(a){this._state_name=a};!function(a){var b=a.prototype;b.matches=function(a){return a instanceof gc&&(this._state_name===a||this._state_name===a.getName())}}(ic);var jc=function(){};!function(a){var b=a.prototype;b.matches=function(a){return a instanceof gc}}(jc);var kc=function(a,b,c){this.is_pre=a,this.from_state_selector=b,this.to_state_selector=c};!function(a){var b=a.prototype;b.matches=function(a,b){if(a instanceof hc&&this.is_pre===b){var c=a.getFrom(),d=a.getTo();return this.from_state_selector.matches(c)&&this.to_state_selector.matches(d)}return!1}}(kc);var lc=function(a){this.selectors=a};!function(a){var b=a.prototype;b.matches=function(){var a=arguments;return G(this.selectors,function(b){return b.matches.apply(b,a)})}}(lc);var mc=function(a){return"*"===a?new jc:new ic(a)},nc=function(a){var b=$(a.split(","),function(a){return a.trim()});if(1===b.length)return mc(b[0]);var c=$(b,mc);return new lc(c)},oc=function(a,b,c){var d,e,f=nc(a),g=nc(c);return"<->"===b?(d=new kc(!1,f,g),e=new kc(!1,g,f),new lc(d,e)):">-<"===b?(d=new kc(!0,f,g),e=new kc(!0,g,f),new lc(d,e)):"->"===b?new kc(!1,f,g):">-"===b?new kc(!0,f,g):"<-"===b?new kc(!1,g,f):"-<"===b?new kc(!0,g,f):null},pc=new RegExp("^([\\sa-zA-Z0-9,\\-_*]+)((<->|>-<|->|>-|<-|-<)([\\sa-zA-Z0-9,\\-_*]+))?$"),qc=function(a){var b=a.match(pc);if(null===b)return null;if(void 0===b[2]){var c=b[1];return nc(c)}var d=b[1],e=b[3],f=b[4];return oc(d,e,f)},rc=0,sc=function(b,c,d){this._context=d||a,this._selector=b,this._callback=c,this._id=rc++};!function(a){var b=a.prototype;b.interested_in=function(){return this._selector.matches.apply(this._selector,arguments)},b.run=function(){this._callback.apply(this._context,arguments)}}(sc);var tc=function(){this._states={},this._transitions=[],this._curr_state=null,this._listeners=[],this._chain_state=null,this._did_transition=!1,this.state=Eb(function(){return this._curr_state?this._curr_state.getName():null},{context:this});var a=K(arguments,!0);Z(a,this.addState,this)};!function(a){var b=a.prototype;b.createState=function(a){var b=new gc(this,a);return this._states[a]=b,b},b.addState=function(a){var b=this.stateWithName(a);return null===b&&(b=this.createState.apply(this,arguments),null===this._curr_state&&(this._curr_state=b)),this._chain_state=b,this},b.stateWithName=function(a){return this._states[a]||null},b.getState=function(){return this.state.get()},b.addTransition=function(a,b,c){var d,e,f,g,h=!1;if(0===arguments.length)throw new Error("addTransition expects at least one argument");return 1===arguments.length?(h=!0,d=this._chain_state,e=a):2===arguments.length?O(b)||b instanceof uc?(d=this._chain_state,e=a,g=b):(d=a,e=b,h=!0):arguments.length>2&&(d=a,e=b,g=c),f=this._getTransition(d,e),h?v(f.run,f):(g instanceof uc?g._addTransition(f):g.call(this,v(f.run,f),this),this)},b._getTransition=function(a,b){P(a)&&(a=this.stateWithName(a)),P(b)&&(b=this.stateWithName(b));var c=new hc(this,a,b);return this._transitions.push(c),c},b._setState=function(a,b){var c=this.getState(),d=P(a)?this.stateWithName(a):a;if(!d)throw new Error("Could not find state '"+a+"'");this.did_transition=!0,Z(this._listeners,function(a){a.interested_in(b,!0)&&a.run(b,d,c)
}),this._curr_state=d,this.state.invalidate(),Z(this._listeners,function(a){a.interested_in(b,!1)?a.run(b,d,c):a.interested_in(d)&&a.run(b,d,c)})},b.destroy=function(){this.state.destroy(),this._states={},this._transitions=[],this._curr_state=null},b.startsAt=function(a){var b=this.stateWithName(a);return null===b&&(b=this.create_state(a)),this.did_transition||(this._curr_state=b),this._chain_state=b,this},b.is=function(a){var b=this.getState();return null===b?!1:P(a)?b===a:b===a.getName()},b.on=b.addEventListener=function(a,b,c){var d;if(P(a)){if(d=qc(a),null===d)throw new Error("Unrecognized format for state/transition spec.")}else d=a;var e=new sc(d,b,c);return this._listeners.push(e),this},b.off=b.removeEventListener=function(a){return this._listeners=_(this._listeners,function(b){return b.callback!==a}),this}}(tc),Eb.fsm=function(){return new tc(arguments)},Eb.is_fsm=function(a){return a instanceof tc};var uc=function(a,b,c,d){this._do_transition=!1,this._listeners=[],this._transitions=[],this._on_add_transition=c,this._on_remove_transition=d,this._live_fns={},a&&a._listeners.push({event:this,filter:b})};!function(b){var c=b.prototype;c.guard=function(a){return new uc(this,a)},c._addTransition=function(a){this._transitions.push(a),this._on_add_transition&&(this._live_fns[a.id()]=this._on_add_transition(a))},c._removeTransition=function(a){var b=db(this._transitions,a);if(b>=0){this._transitions.splice(b,1),this._on_remove_transition&&this._on_remove_transition(a);var c=a.id();this._live_fns[c].destroy(),delete this._live_fns[c]}},c._fire=function(){var b=arguments;Z(this._transitions,function(a){a.run.apply(a,b)}),Z(this._listeners,function(c){var d=c.event,e=c.filter;(!e||e.apply(a,b))&&d._fire.apply(d,b)})}}(uc);var vc=function(b){return b===a||R(b)},wc=function(a){return a.trim()},xc=function(a){return $(a.split(" "),wc)},yc="timeout";Eb.on=function(b){var c=arguments.length>1?j.call(arguments,1):a,d=new uc(!1,!1,function(a){var d=[],e=!1,f=[],g=v(a.run,a),h=a.getFSM(),i=a.getFrom(),j=new ic(i),k=new kc(!0,j,new jc),l=function(){Z(f,function(a){if(a===yc){e&&(y(e),e=!1);var b=Eb.get(c[0]);(!M(b)||0>b)&&(b=0),e=x(g,b)}else Z(d,function(b){b.addEventListener(a,g)})})},m=function(){Z(f,function(a){Z(d,function(b){a===yc?e&&(y(e),e=!1):b.removeEventListener(a,g)})})},n=Eb.liven(function(){m(),f=xc(Eb.get(b)),d=_(Vb(c),vc),h.on(j,l).on(k,m),h.is(i)&&l()});return n});return d};var zc=function(a){zc.superclass.constructor.call(this,this._getter,ab({context:this},a)),this.$getter=Eb.constraint(void 0,{literal:!0})};!function(a){W(a,b);var c=a.prototype;c._getter=function(){var a=this.$getter.get();return O(a)?a.call(this):Eb.get(a)},c.inFSM=function(a,b){return Z(b,function(b,c){a.on(c,function(){this.$getter.set(b)},this),a.is(c)&&this.$getter.set(b)},this),this}}(zc),Eb.inFSM=function(){var a=new zc;return a.inFSM.apply(a,arguments)},Eb.FSMConstraint=zc;var Ac=function(a){var b={};return Z(a.split(","),function(a){b[a]=!0}),b},Bc=/^<([\-A-Za-z0-9_]+)((?:\s+[a-zA-Z0-9_\-]+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)>/,Cc=/^<\/([\-A-Za-z0-9_]+)[^>]*>/,Dc=/^\{\{([#=!>|{\/])?\s*((?:(?:"[^"]*")|(?:'[^']*')|[^\}])*)\s*(\/?)\}?\}\}/,Ec=/([\-A-Za-z0-9_]+)(?:\s*=\s*(?:(?:"((?:\\.|[^"])*)")|(?:'((?:\\.|[^'])*)')|([^>\s]+)))?/g,Fc="hb",Gc="html",Hc=Ac("area,base,basefont,br,col,frame,hr,img,input,isindex,link,meta,param,embed"),Ic=Ac("address,applet,blockquote,button,center,dd,del,dir,div,dl,dt,fieldset,form,frameset,hr,iframe,ins,isindex,li,map,menu,noframes,noscript,object,ol,p,pre,script,table,tbody,td,tfoot,th,thead,tr,ul"),Jc=Ac("a,abbr,acronym,applet,b,basefont,bdo,big,br,button,cite,code,del,dfn,em,font,i,iframe,img,input,ins,kbd,label,map,object,q,s,samp,script,select,small,span,strike,strong,sub,sup,textarea,tt,u,var"),Kc=Ac("colgroup,dd,dt,li,options,p,td,tfoot,th,thead,tr"),Lc=Ac("checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected"),Mc=Ac("script,style"),Nc={state:{parent:["fsm"]},elif:{parent:["if"]},"else":{parent:["if","each"]}},Oc={elif:{when_open_sibling:["elif","else"]},"else":{when_close_parent:["if","each"]},state:{when_open_sibling:["state"]}},Pc={elif:{follows:["elif"],or_parent:["if"]},"else":{follows:["elif"],or_parent:["if","each"]},state:{follows:["state"],or_parent:["fsm"]}},Qc=function(a,b){function c(a,c,e,f){if(c=c.toLowerCase(),Ic[c])for(;n.last()&&Jc[n.last()];)d("",n.last());if(Kc[c]&&n.last()==c&&d("",c),f=Hc[c]||!!f,f||n.push({type:Gc,tag:c}),b.startHTML){var g=[];e.replace(Ec,function(a,b){var c=arguments[2]?arguments[2]:arguments[3]?arguments[3]:arguments[4]?arguments[4]:Lc[b]?b:"";g.push({name:b,value:c,escaped:c.replace(/(^|[^\\])"/g,'$1\\"')})}),b.startHTML(c,g,f)}}function d(a,b){g(b,Gc)}function e(){var a,b;for(a=n.length-1;a>=0;a--)if(b=n[a],b.type===Fc)return b;return void 0}function f(a,c,d){var f,h,i=Cd(d);switch(i.type===rd?i.body.length>0&&i.body[0].type===sd&&(h=i.body[0].name):i.type===sd&&(h=i.name),c){case void 0:b.startHB(h,i,!0,!1);break;case"{":b.startHB(h,i,!0,!0);break;case">":b.partialHB(h,i);break;case"#":if(f=e(),f&&Y(Oc,f.tag)){var k=Oc[f.tag];k.when_open_sibling.indexOf(h)>=0&&(g(f.tag,Fc),f=e())}if(Y(Nc,h)){var l=Nc[h];if(!f||db(l.parent,f.tag)<0)throw new Error("'"+h+"' must be inside of a '"+l.parent+"' block")}if(Y(Pc,h)){var m=Pc[h];if(m.follows.indexOf(j)<0&&(!m.or_parent||m.or_parent.indexOf(f.tag)<0)){var o="'"+h+"' must follow a '"+m.follows[0]+"'";throw m.or_parent&&(o+=" or be inside of a '"+m.or_parent[0]+"' tag"),new Error(o)}}n.push({type:Fc,tag:h}),b.startHB(h,i,!1);break;case"/":g(h,Fc)}}function g(a,c){var d,e,f;for(e=n.length-1;e>=0&&(n[e].type!==c||n[e].tag!==a);e-=1);if(e>=0){for(d=n.length-1;d>=e;d--)f=n[d],f.type===Fc?b.endHB&&b.endHB(f.tag):b.endHTML&&b.endHTML(f.tag);n.length=e}c===Fc&&(j=a)}var h,i,j,k,l,m,n=[],o=a;n.last=function(){return this[this.length-1]};for(var p=function(a,c){return c=c.replace(/<!--(.*?)-->/g,"$1").replace(/<!\[CDATA\[(.*?)\]\]>/g,"$1"),b.chars&&b.chars(c),""};a;){if(l=!0,n.last()&&Mc[n.last()])a=a.replace(new RegExp("(.*)</"+n.last()+"[^>]*>"),p),d("",n.last());else if(0===a.indexOf("<!--")?(k=a.indexOf("-->"),k>=0&&(b.HTMLcomment&&b.HTMLcomment(a.substring(4,k)),a=a.substring(k+3),l=!1)):0===a.indexOf("</")?(m=a.match(Cc),m&&(a=a.substring(m[0].length),m[0].replace(Cc,d),l=!1)):0===a.indexOf("<")?(m=a.match(Bc),m&&(a=a.substring(m[0].length),m[0].replace(Bc,c),l=!1)):0===a.indexOf("{{")&&(m=a.match(Dc),m&&(a=a.substring(m[0].length),m[0].replace(Dc,f),l=!1)),l){h=a.indexOf("<"),i=a.indexOf("{{"),k=0>h?i:0>i?h:Math.min(h,i);var q=0>k?a:a.substring(0,k);a=0>k?"":a.substring(k),b.chars(q)}if(a==o)throw"Parse Error: "+a;o=a}d()},Rc=function(a){return a.isDynamicHTML},Sc=function(a){return bb(a,Rc)>=0},Tc=function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},Uc=function(a,b,c,d,e){return a?a[b.computed?Yc(b,c,d,e):b.name]:void 0},Vc={},Wc=function(a){return a.type===rd?a.body[0]:a},Xc=function(a){return{type:rd,body:a.type===rd?H(a.body):[]}},Yc=function(b,c,d,e){var f,g,h,i;if(b)switch(b.type){case vd:return F(d).this_exp;case ud:return b.value;case xd:return f=z[b.operator],f?f(Yc(b.argument,c,d,e)):void 0;case yd:case zd:return f=A[b.operator],f?f(Yc(b.left,c,d,e),Yc(b.right,c,d,e)):void 0;case sd:if("@"===b.name[0]){for(var j=b.name.slice(1),k=d.length-1;k>=0;k--)if(g=d[k].at,g&&Y(g,j))return g[j];return void 0}return Eb.get(c[b.name]);case td:return g=Yc(b.object,c,d,e),Uc(g,b.property,c,d,e);case rd:return Yc(b.body[0],c,d,e);case Bd:return g=F(d).this_exp,Uc(g,b.argument,c,d,e);case Ad:return g=d&&d.length>1?d[d.length-2].this_exp:void 0,Uc(g,b.argument,c,d,e);case wd:if(b.callee.type===td?(h=Yc(b.callee.object,c,d,e),g=Uc(h,b.callee.property,c,d,e)):(h=a,g=Yc(b.callee,c,d,e)),g&&O(g))return i=$(b.arguments,function(a){return Yc(a,c,d,e)}),g.apply(h,i)}},Zc=function(a,b,c,d){return Eb(function(){return $(a,function(a){if(a.isDynamicHTML)return Eb.get(b[a.tag]);if(Y(a,"text"))return Tc(a.text);if(Y(a,"tag"))return Tc(Eb.get(b[a.tag]));var e=a.create(b,c,d);return e.outerHTML}).join("")})},$c=function(a,b){return Eb(function(){var c=[];return Z(a,function(a){var d=a.create.apply(a,b);N(d)?c.push.apply(c,d):c.push(d)}),c})},_c=function(a,b,c){var d,e=[a,[{this_exp:a}],c],f=b||w.createElement("span");if(1===this.children.length&&(d=this.children[0])&&d.isHTML)return d.create.apply(d,e);if(Sc(this.children)){var g=Zc(this.children,a);c.push(g,Eb.html(f,g))}else{var h=$c(this.children,e);c.push(h,Eb.children(f,h))}return f},ad=/^\{\{([\-A-Za-z0-9_]+)\}\}/,bd=function(a,b){for(var c,d,g,h,i=!1,j=[];a.length>0;){if(c=a.indexOf("{"),0>c){j.push(a);break}d=a.match(ad),d?(g=d[0].length,h=b[d[1]],a=a.substr(g),j.push(h),i||!e(h)&&!f(h)||(i=!0)):(j.push(a.substr(0,c)),a=a.substr(c))}return i?Eb(function(){return $(j,function(a){return e(a)?a.get():f(a)?a.join(" "):""+a}).join("")}):j.join("")},cd=function(){var a=[],b=[];return{get:function(c,d){var e=bb(a,function(a){return a[0]===c&&a[1].length===d.length&&I(a[1],function(a,b){return a.this_exp===d[b].this_exp})});return b[e]},set:function(c,d,e,f){a.push([c,d,e]),b.push(f)}}},dd={},ed=function(a,b){return a===b||a&&a.is_obj===dd&&a.key===b.key&&a.value===b.value},fd=/^(data-)?cjs-out$/,gd=/^(data-)?cjs-on-(\w+)$/,hd=function(a){var b=[{children:[],create:_c}],c=!1,d=[],f=[];return Qc(a,{startHTML:function(a,d,f){c={create:function(b,c,f){var g,h=arguments,i=w.createElement(a);if(Z(d,function(a){if(a.name.match(fd))b[a.value]=Eb.inputValue(i);else if(g=a.name.match(gd)){var d=g[2];i.addEventListener(d,b[a.value])}else{var h=bd(a.value,b,c,f);e(h)?Eb.attr(i,a.name,h):i.setAttribute(a.name,h)}}),Sc(this.children)){var j=Zc(this.children,b,c,f);f.push(j,Eb.html(i,j))}else{var k=$c(this.children,h);f.push(k,Eb.children(i,k))}return i},children:[],isHTML:!0},b.length>0&&F(b).children.push(c),f||b.push(c)},endHTML:function(){c=b.pop()},HTMLcomment:function(a){c={create:function(){return w.createComment(a)},isText:!0,text:a},b.length>0&&F(b).children.push(c)},chars:function(a){c={create:function(){return w.createTextNode(a)},isText:!0,text:a},b.length>0&&F(b).children.push(c)},startHB:function(a,e,g,h){var i,j,k,l;if(g)h?(k="isDynamicHTML",j="html"):(k="isText",j="text"),c={create:function(a,b,c){var d=w.createTextNode(""),f=Yc(Wc(e),a,b,c);return c.push(Eb[j](d,f)),d},tag:a},c[k]=!0,b.length>0&&F(b).children.push(c);else{if(l=!0,"each"===a)i=cd(),c={create:function(a,b,c){var d,f,g,h,j=Yc(Xc(e),a,b,c),k=i.get(a,b,c);return N(j)?0===j.length&&this.else_child&&(j=[Vc]):j=$(j,function(a,b){return{key:b,value:a,is_obj:dd}}),k?(d=k.val,f=k.dom,g=k.lineage):(d=[],f=[],g=[],i.set(a,b,c,{val:j,dom:f,lineage:g})),h=zb(d,j,ed),Z(h.index_changed,function(a){var b=g[a.from];b&&b.at&&b.at.index&&b.at.index.set(a.to)}),Z(h.removed,function(a){var b=a.from,c=g[b];f.splice(b,1),c&&c.at&&Z(c.at,function(a){a.destroy(!0)})}),Z(h.added,function(d){var e=d.item,h=d.to,i=e===Vc,j=i?!1:{this_exp:e,at:e&&e.is_obj===dd?{key:Eb(e.key)}:{index:Eb(h)}},k=i?b:b.concat(j),l=$(i?this.else_child.children:this.children,function(b){var d=b.create(a,k,c);return d});f.splice(h,0,l),g.splice(h,0,j)},this),Z(h.moved,function(a){var b=a.from_index,c=a.to_index,d=f[b],e=g[b];f.splice(b,1),f.splice(c,0,d),g.splice(b,1),g.splice(c,0,e)}),d.splice.apply(d,[0,d.length].concat(j)),K(f,!0)},children:[],isEach:!0,else_child:!1};else if("if"===a||"unless"===a)i=cd(),c={create:function(a,b,c){var d,e=(i.get(a,b,c),this.sub_conditions.length),f=!!Yc(this.condition,a,b,c),g=-1;if(this.reverse&&(f=!f),f)g=0;else if(e>0)for(g=0;e>g;g++)if(f=this.sub_conditions[g],f.condition===Vc||Yc(f.condition,a,b,c)){g++;break}if(0>g)return[];var h=i.get(a,b,c);return h||(h=[],i.set(a,b,c,h)),h[g]||(d=0===g?this.children:this.sub_conditions[g-1].children,h[g]=K($(d,function(d){return d.create(a,b,c)}),!0)),h[g]},children:[],sub_conditions:[],condition:Xc(e),reverse:"unless"===a},d.push(c);else if("elif"===a||"else"===a){c={children:[],condition:"else"===a?Vc:Xc(e)};var m=F(b);m.isEach?m.else_child=c:F(d).sub_conditions.push(c),l=!1}else if("fsm"===a){i=cd();var n=Xc(e);c={create:function(a,b,c){var d,e,f=Yc(n,a,b,c),g=f.getState(),h=function(d){return d.create(a,b,c)};b||(b=[]);for(d in this.sub_states)if(this.sub_states.hasOwnProperty(d)&&g===d)return e=i.get(a,b,c),e||(e={},i.set(a,b,c,e)),Y(e,d)||(e[d]=$(this.sub_states[d].children,h)),e[d];return[]},children:[],sub_states:{}},f.push(c)}else if("state"===a){if(e.body.length>1){var o=e.body[1].name;c={children:[]},F(f).sub_states[o]=c,l=!1}}else{if("with"!==a)return;c={create:function(a,b,c){var d=Yc(Xc(e),a,b,c),f=b.concat({this_exp:d});return $(this.children,function(a){return a.create(d,f,c)})},children:[]}}l&&b.length>0&&F(b).children.push(c),b.push(c)}},endHB:function(a){"if"===a||"unless"===a?d.pop():"fsm"===a&&f.pop(),b.pop()},partialHB:function(a,d){var e=md[a];e&&(c={create:function(a,b,c){var f=Yc(Xc(d),a,b,c);return e(f)}},b.length>0&&F(b).children.push(c))}}),b.pop()},id=[],jd=[],kd=[],ld=[],md={},nd=function(a){return Sb(a)||Ub(a)||S(a)},od=function(a,b){var c=this,d=[],e=c.create(a,b,d);return id.push(e),jd.push(d),e},pd=function(a){var b=db(id,a);return b>=0?jd[b]:!1},qd=function(a){P(a)||(a=Sb(a)||Ub(a)?a.length>0?a[0].innerText:"":R(a)?a.innerText:""+a);var b,c=db(kd,a);return 0>c?(b=hd(a),kd.push(a),ld.push(b)):b=ld[c],arguments.length>=2?od.apply(b,H(arguments)):v(od,b)};Eb.createTemplate=Eb.template=qd,Eb.registerPartial=function(a,b){md[a]=b},Eb.unregisterPartial=function(a){delete md[a]},Eb.destroyTemplate=function(a){var b=db(id,a);if(b>=0){var c=jd[b];return id.splice(b,1),jd.splice(b,1),Z(c,function(a){a.destroy()}),!0}return!1},Eb.pauseTemplate=function(a){var b=pd(a);return Z(b,function(a){Y(a,"pause")&&a.pause()}),!!b},Eb.resumeTemplate=function(a){var b=pd(a);return Z(pd(a),function(a){Y(a,"resume")&&a.resume()}),!!b};var rd="Compound",sd="Identifier",td="MemberExpression",ud="Literal",vd="ThisExpression",wd="CallExpression",xd="UnaryExpression",yd="BinaryExpression",zd="LogicalExpression",Ad="ParentExpression",Bd="CurrLevelExpression",Cd=function(){var a=E(z),b=E(A),c=b.length,d={"true":!0,"false":!1,"null":null},e="this",f=function(a){switch(a){case"||":return 1;case"&&":return 2;case"|":return 3;case"^":return 4;case"&":return 5;case"==":case"!=":case"===":case"!==":return 6;case"<":case">":case"<=":case">=":return 7;case"<<":case">>":case">>>":return 8;case"+":case"-":return 9;case"*":case"/":case"%":return 11}return 0},g=function(a,b,c){var d="||"===a||"&&"===a?zd:yd;return{type:d,operator:a,left:b,right:c}},h=function(a){return a>=48&&57>=a},i=function(a){return 36===a||95===a||64===a||a>=65&&90>=a||a>=97&&122>=a},j=function(a){return 36===a||95===a||a>=65&&90>=a||a>=97&&122>=a||a>=48&&57>=a},k=(new RegExp("^['\"]"),new RegExp("^(\\d+(\\.\\d+)?)"),function(k){var l=0,m=k.length,n=function(){for(var a,b,c=[];m>l;)if(a=k[l],";"===a||","===a)l++;else if(b=p())c.push(b);else if(m>l)throw new Error("Unexpected '"+k[l]+"' at character "+l);return 1===c.length?c[0]:{type:rd,body:c}},o=function(){var a,d,e,f;r();a:for(d=0;c>d;d++){for(a=b[d],f=a.length,e=0;f>e;e++)if(a[e]!==k[l+e])continue a;return l+=f,a}return!1},p=function(){var a,b,c,d,e,h,i,j;if(h=q(),b=o(),c=f(b),0===c)return h;if(e={value:b,prec:c},i=q(),!i)throw new Error("Expected expression after "+b+" at character "+l);for(d=[h,e,i];(b=o())&&(c=f(b),0!==c);){for(e={value:b,prec:c};d.length>2&&c<=d[d.length-2].prec;)i=d.pop(),b=d.pop().value,h=d.pop(),a=g(b,h,i),d.push(a);if(a=q(),!a)throw new Error("Expected expression after "+b+" at character "+l);d.push(e),d.push(a)}for(j=d.length-1,a=d[j];j>1;)a=g(d[j-1].value,d[j-2],a),j-=2;return a},q=function(){var b,c;return r(),b=k.charCodeAt(l),46===b&&47===k.charCodeAt(l+1)?(l+=2,{type:Bd,argument:q()}):46===b&&46===k.charCodeAt(l+1)&&47===k.charCodeAt(l+2)?(l+=3,{type:Ad,argument:q()}):h(b)||46===b?s():39===b||34===b?t():i(b)?w():(c=a.indexOf(b))>=0?(l++,{type:xd,operator:a[c],argument:q(),prefix:!0}):40===b?(l++,x()):!1},r=function(){for(var a=k.charCodeAt(l);32===a||9===a;)a=k.charCodeAt(++l)},s=function(){for(var a="";h(k.charCodeAt(l));)a+=k[l++];if("."===k[l])for(a+=k[l++];h(k.charCodeAt(l));)a+=k[l++];return{type:ud,value:parseFloat(a),raw:a}},t=function(){for(var a,b="",c=k[l++],d=!1;m>l;){if(a=k[l++],a===c){d=!0;break}if("\\"===a)switch(a=k[l++]){case"n":b+="\n";break;case"r":b+="\r";break;case"t":b+="	";break;case"b":b+="\b";break;case"f":b+="\f";break;case"v":b+=""}else b+=a}if(!d)throw new Error('Unclosed quote after "'+b+'"');return{type:ud,value:b,raw:c+b+c}},u=function(){var a,b=k.charCodeAt(l),c=l;for(i(b)&&l++;m>l&&(b=k.charCodeAt(l),j(b));)l++;return a=k.slice(c,l),d.hasOwnProperty(a)?{type:ud,value:d[a],raw:a}:a===e?{type:vd}:{type:sd,name:a}},v=function(){for(var a,b,c=[];m>l;){if(r(),a=k[l],")"===a){l++;break}if(","===a)l++;else{if(b=p(),!b||b.type===rd)throw new Error("Expected comma at character "+l);c.push(b)}}return c},w=function(){var a,b,c;for(b=u(),a=k[l];"."===a||"["===a||"("===a;){if("."===a)l++,b={type:td,computed:!1,object:b,property:u()};else if("["===a){if(c=l,l++,b={type:td,computed:!0,object:b,property:p()},r(),a=k[l],"]"!==a)throw new Error("Unclosed [ at character "+l);l++}else"("===a&&(l++,b={type:wd,arguments:v(),callee:b});a=k[l]}return b},x=function(){var a=p();if(r(),")"===k[l])return l++,a;throw new Error("Unclosed ( at character "+l)};return n()});return k}(this);return Eb}(this);"undefined"!=typeof module&&module.exports&&(module.exports=cjs);
//# sourceMappingURL=cjs.min.js.map